const cds = require('../index')
const ql = require('./cds-ql')

module.exports = function (options) {
  if (cds.session) {
    return cds
  }

  const primary = cds.session = ql.connect.connect(options)

  // Decorate cds to serve as a shortcut to the primary session
  Object.defineProperties(cds, {
    run: {configurable: true, value: (...a) => primary.run(...a)},
    foreach: {configurable: true, value: (...a) => primary.foreach(...a)},
    deploy: {configurable: true, value: (...a) => primary.deploy(...a)},
    model: {configurable: true, get: () => primary.model},
    disconnect: {configurable: true, value: (...a) => primary.disconnect(...a)}
  })

  return cds
}
