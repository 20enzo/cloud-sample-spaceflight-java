module.exports.parseArgs = (cmd, args) => {

  const options = {}
  const argv = []
  const _flags = cmd.flags || []
  const _options = cmd.options || []
  const _shortcuts = cmd.shortcuts || []

  _flags.push('--new-csn')
  _options.push('--sql')

  for (let i = 0; i < args.length; ++i) {
    let a = args[i]
    let ox = _shortcuts.indexOf(a)
    if (ox >= 0) {
      if (ox > _options.length) { options[_flags[ox].slice(2)] = true; continue }
      else a = _options[ox]
    } else {
      ox = _flags.indexOf(a);
      if (ox >= 0) { options[_flags[ox].slice(2)] = true; continue }
    }
    ox = _options.indexOf(a)
    if (ox >= 0) {
      let optValue = true
      if (args[i + 1] && !args[i + 1].startsWith('-'))  { i++; optValue = args[i] }
      options[_options[ox].slice(2)] = optValue
      continue
    }
    if (a.startsWith('-'))  throw new Error('invalid option: ' + a)
    else argv.push(a)
  }
  return { argv, options }
}
