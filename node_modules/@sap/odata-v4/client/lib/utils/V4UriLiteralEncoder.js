'use strict';

const AbstractValueEncoder = require('./AbstractValueEncoder');
const UriHelper = require('../../../lib/uri/UriHelper');
const EdmPrimitiveTypeKind = require('../../../lib/edm/EdmPrimitiveTypeKind');
const V4JsonLiteralEncoder = require('./V4JsonLiteralEncoder');

class V4UriLiteralEncoder extends AbstractValueEncoder {

    constructor() {
        super();
        this._v4JsonEncoder = new V4JsonLiteralEncoder(true);
    }

    /**
     * @inheritDoc
     * @return {string}
     */
    encode(value, type) {
        if (!type) return value.toString();
        const encodedValue = UriHelper.toUriLiteral(this._v4JsonEncoder.encode(value, type).toString(), type);
        if (type === EdmPrimitiveTypeKind.String) return encodeURIComponent(encodedValue);
        return encodedValue;
    }
}

module.exports = V4UriLiteralEncoder;
