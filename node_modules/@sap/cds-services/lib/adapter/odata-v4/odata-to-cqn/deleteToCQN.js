const {FeatureNotSupported} = require('../../../errors')

/**
 * Transform odata DELETE request into a CQN object.
 *
 * @param context - Contains request information and utility methods like statements.
 * @param req - An odata request.
 * @private
 */
const deleteToCQN = (context, req) => {
  const segment = req.getUriInfo().getPathSegments()[0]

  if (segment.getKind() === 'ENTITY') {
    const key = segment.getKeyPredicates()[0].getEdmRef().getName()
    const value = segment.getKeyPredicates()[0].getText()
    return context.statements.DELETE.from(context.target).where(key, value)
  } else {
    throw new FeatureNotSupported(`DELETE of kind ${segment.getKind()} is not supported`)
  }
}

module.exports = deleteToCQN
